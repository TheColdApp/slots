<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Enhanced Casino Slot Machine</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #222;
      color: white;
      text-align: center;
      padding-top: 50px;
      user-select: none;
    }

    .slot-machine {
      display: inline-block;
      background: #444;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      max-width: 400px;
      margin: auto;
    }

    .reels {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .reel {
      font-size: 50px;
      width: 90px;
      height: 90px;
      line-height: 90px;
      background: #000;
      margin: 0 10px;
      border-radius: 10px;
      border: 2px solid #fff;
      transition: transform 0.3s ease;
    }

    button, select, input {
      padding: 10px 15px;
      font-size: 18px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }

    button:disabled {
      background: #555;
      cursor: not-allowed;
    }

    button {
      background-color: #0f0;
      color: #000;
      font-weight: bold;
    }

    select, input {
      background-color: #333;
      color: white;
    }

    .message {
      margin-top: 15px;
      font-size: 24px;
      min-height: 30px;
    }

    .coins, .bet-section, .login-section, .leaderboard {
      margin-top: 15px;
      font-size: 18px;
    }

    .leaderboard {
      background: #333;
      padding: 10px;
      border-radius: 10px;
      text-align: left;
      max-width: 350px;
      margin: 20px auto 0;
    }

    input[type="text"] {
      padding: 8px;
      font-size: 16px;
      width: 150px;
    }

    #refillBtn {
      background-color: #08f;
      color: white;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="slot-machine">

    <!-- Login -->
    <div class="login-section" id="loginSection">
      <h2>Login / Enter Username</h2>
      <input type="text" id="usernameInput" placeholder="Your name" />
      <button onclick="login()">Login</button>
    </div>

    <!-- Game Area -->
    <div id="gameArea" style="display:none;">
      <h2>Welcome, <span id="usernameDisplay"></span>!</h2>
      <div class="coins" id="coinsDisplay">üí∞ Coins: 100</div>

      <div class="bet-section">
        <label for="betSelect">Bet Amount: </label>
        <select id="betSelect">
          <option value="1">1 Coin</option>
          <option value="5">5 Coins</option>
          <option value="10">10 Coins</option>
        </select>
      </div>

      <div class="reels">
        <div class="reel" id="reel1">üçí</div>
        <div class="reel" id="reel2">üçã</div>
        <div class="reel" id="reel3">üîî</div>
      </div>

      <button id="spinButton" onclick="spin()">Spin</button>
      <button id="refillBtn" onclick="refillCoins()">Refill 100 Coins</button>

      <div class="message" id="message"></div>

      <div class="leaderboard" id="leaderboardSection">
        <h3>Leaderboard</h3>
        <ol id="leaderboardList"></ol>
      </div>
    </div>

  </div>

  <audio id="spinSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="winSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

  <script>
    // Symbols for the slots
    const symbols = ['üçí', 'üçã', 'üîî', 'üçä', 'üíé', '7Ô∏è‚É£'];

    // Game state
    let coins = 100;
    let username = '';
    let isSpinning = false;

    // HTML elements
    const coinsDisplay = document.getElementById('coinsDisplay');
    const messageDisplay = document.getElementById('message');
    const spinButton = document.getElementById('spinButton');
    const betSelect = document.getElementById('betSelect');
    const reelElements = [
      document.getElementById('reel1'),
      document.getElementById('reel2'),
      document.getElementById('reel3')
    ];

    const spinSound = document.getElementById('spinSound');
    const winSound = document.getElementById('winSound');

    const loginSection = document.getElementById('loginSection');
    const gameArea = document.getElementById('gameArea');
    const usernameInput = document.getElementById('usernameInput');
    const usernameDisplay = document.getElementById('usernameDisplay');
    const leaderboardList = document.getElementById('leaderboardList');

    // Utilities
    function getRandomSymbol() {
      return symbols[Math.floor(Math.random() * symbols.length)];
    }

    // Update coins display and button state
    function updateCoinsDisplay() {
      coinsDisplay.textContent = `üí∞ Coins: ${coins}`;
      spinButton.disabled = coins < parseInt(betSelect.value) || isSpinning;
    }

    // Spin animation: change symbols quickly for 1 second
    function animateReels() {
      let frames = 20; // how many times symbols change
      let frame = 0;

      return new Promise(resolve => {
        const interval = setInterval(() => {
          reelElements.forEach(el => {
            el.textContent = getRandomSymbol();
            // Small bounce effect
            el.style.transform = `translateY(${Math.random() * 10 - 5}px)`;
          });

          frame++;
          if (frame >= frames) {
            clearInterval(interval);
            // Reset transform
            reelElements.forEach(el => el.style.transform = 'translateY(0)');
            resolve();
          }
        }, 50);
      });
    }

    // Spin logic
    async function spin() {
      if (isSpinning) return;
      const bet = parseInt(betSelect.value);

      if (coins < bet) {
        messageDisplay.textContent = "‚ùå Not enough coins to bet that amount!";
        return;
      }

      isSpinning = true;
      messageDisplay.textContent = "";
      coins -= bet;
      updateCoinsDisplay();

      // Play spin sound
      spinSound.currentTime = 0;
      spinSound.play();

      // Animate reels
      await animateReels();

      // Final spin result
      const results = [getRandomSymbol(), getRandomSymbol(), getRandomSymbol()];

      // Show results
      for (let i = 0; i < 3; i++) {
        reelElements[i].textContent = results[i];
      }

      // Check winnings
      if (results[0] === results[1] && results[1] === results[2]) {
        // Jackpot win ‚Äî payout 10x bet
        const winnings = bet * 10;
        coins += winnings;
        messageDisplay.textContent = `üéâ JACKPOT! You won ${winnings} coins! üéâ`;
        winSound.currentTime = 0;
        winSound.play();
      } else if (results[0] === results[1] || results[1] === results[2] || results[0] === results[2]) {
        // Small win ‚Äî payout 2x bet
        const winnings = bet * 2;
        coins += winnings;
        messageDisplay.textContent = `üòä Nice! You won ${winnings} coins!`;
        winSound.currentTime = 0;
        winSound.play();
      } else {
        messageDisplay.textContent = "üòû No match. Try again!";
      }

      updateCoinsDisplay();
      isSpinning = false;

      updateLeaderboard();
    }

    // Refill coins button
    function refillCoins() {
      coins += 100;
      messageDisplay.textContent = "üîÑ Coins refilled by 100!";
      updateCoinsDisplay();
    }

    // Login function
    function login() {
      const name = usernameInput.value.trim();
      if (!name) {
        alert("Please enter a username.");
        return;
      }
      username = name;
      usernameDisplay.textContent = username;
      loginSection.style.display = 'none';
      gameArea.style.display = 'block';

      // Load saved coins if exist
      const savedCoins = localStorage.getItem(`coins_${username}`);
      if (savedCoins !== null) {
        coins = parseInt(savedCoins);
      } else {
        coins = 100;
      }
      updateCoinsDisplay();

      updateLeaderboard();
    }

    // Save coins when window closes or user changes
    window.addEventListener('beforeunload', () => {
      if (username) {
        localStorage.setItem(`coins_${username}`, coins);
      }
    });

    // Leaderboard using localStorage
    function updateLeaderboard() {
      // Save current user score
      if (username) {
        localStorage.setItem(`coins_${username}`, coins);
      }

      // Gather all users coins from localStorage
      const users = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('coins_')) {
          users.push({
            username: key.replace('coins_', ''),
            coins: parseInt(localStorage.getItem(key))
          });
        }
      }

      // Sort descending by coins
      users.sort((a, b) => b.coins - a.coins);

      // Show top 5
      leaderboardList.innerHTML = '';
      users.slice(0, 5).forEach(user => {
        const li = document.createElement('li');
        li.textContent = `${user.username}: ${user.coins} coins`;
        leaderboardList.appendChild(li);
      });
    }

    // Update spin button on bet change
    betSelect.addEventListener('change', updateCoinsDisplay);
  </script>

</body>
</html>
